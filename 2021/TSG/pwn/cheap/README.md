# cHeap  
libc 2.31  
ヒープオーバーフローとか  
### libc leak  
ヒープオーバーフローでサイズを書き換えて0x420のチャンクをfree  
Unsortedにつながり`show`でリークできる  
```
0x0000000000000000  0x0000000000000021
0x0000000000000000  0x0000000000000000  
0x0000000000000000  0x00000000000003f1      <----
0x0000000000000000  0x0000000000000000          |
0x0000000000000000  0x0000000000000000          |
                　～                                合わせて0x420  
0x0000000000000000  0x0000000000000031          |
0x0000000000000000  0x0000000000000000          |
0x0000000000000000  0x0000000000000000          | 
0x0000000000000000  0x0000000000000000      <----
0x0000000000000000  0x0000000000000031      <- 統合防止  

                   ↓

0x0000000000000000  0x0000000000000021
0x4141414141414141  0x4141414141414141  
0x4141414141414141  0x0000000000000421      
0x0000000000000000  0x0000000000000000      <- ここをfree   
0x0000000000000000  0x0000000000000000          
                　～                                 
0x0000000000000000  0x0000000000000031          
0x0000000000000000  0x0000000000000000          
0x0000000000000000  0x0000000000000000           
0x0000000000000000  0x0000000000000000      
0x0000000000000000  0x0000000000000031      
```

### Overwrite `__free_hook`  
0x40のチャンクのヒープオーバーフローで真下の0x50のチャンクのサイズを0x61に書き換えてfree  
0x60のtcacheに2つのチャンクがつながる  
```
0x0000000000000000  0x0000000000000041
0x0000000000000000  0x0000000000000000  
0x0000000000000000  0x0000000000000000  
0x0000000000000000  0x0000000000000000
0x0000000000000000  0x0000000000000051       <- ここを0x61に書き換えてfree
0x0000000000000000  0x0000000000000000      
0x0000000000000000  0x0000000000000000
0x0000000000000000  0x0000000000000000  
0x0000000000000000  0x0000000000000000
0x0000000000000000  0x0000000000000061
```
再び0x40のチャンクを確保してヒープオーバーフローでfdを`__free_hook`に書き換える  
`malloc(0x58)`を2回すると`__free_hook`が返る  
```
0x0000000000000000  0x0000000000000041
0x4141414141414141  0x4141414141414141  
0x4141414141414141  0x4141414141414141  
0x4141414141414141  0x4141414141414141
0x4141414141414141  0x0000000000000061       
    __free_hook     0x0000000000000000      
0x0000000000000000  0x0000000000000000
0x0000000000000000  0x0000000000000000  
0x0000000000000000  0x0000000000000000
0x0000000000000000  0x0000000000000061
```
flag: `TSGCTF{Heap_overflow_is_easy_and_nice_yeyey}`  
